function generateMessage() {
  var form = FormApp.openById('1x8JleU7OxOLAsukjslk0u4wP6QgqUZRogtEMwK30s0A');
  var candidates = form.getResponses();
  
  for (var i = 0; i < candidates.length; i++) {
    var application = new Application(candidates[i]);
  }   
  
  application.submit()  
} //function process_form        

class Application {
  constructor(candidate) {
    this.candidate = candidate;
    this.text = ' ';
    this.tokens = {
      'software_token' : 'HCPgUGdqsiEFFdDEbEYxC3yWYKgzIVLPH8WTNSv1rqH', 
      'innovation_token' : 'VFcWalqRmOMWwwKMk57zX9HW63HZlqQY4PMAH75SJ7P', 
      'sales_token' : 'irG7QdntaHWmT19gieb07ANffbpkXuRwcqCVrpY56gf',
      'hr_token' : 'Jj06zSJp3vlTudIsEkKFqPyuH47ZSLmwnlnY6ebjHxb'
    };
  } 

  submit() {
    var token;
    var items = this.candidate.getItemResponses();

    for (var j = 0; j < items.length; j++) {
      var question = items[j].getItem().getTitle();
      var answer = items[j].getResponse();
      this.text += '\n' + question +': '+ answer
    }
    
    if (answer == 'Software Engineer') { 
      token = this.tokens['software_token']
    } else if (answer == 'Innovation Engineer') { 
      token = this.tokens['innovation_token']
    } else { token = this.tokens['sales_token']
    }

    var payload = {
      'message': this.text,
    };

    var options = {
      'method' : 'post',
      'headers' : {'Authorization': "Bearer " + token},
      'contentType': 'application/x-www-form-urlencoded',
      'payload' : payload
      };
      var response = UrlFetchApp.fetch("https://notify-api.line.me/api/notify", options);

    var optionHR = {
      'method' : 'post',
      'headers' : {'Authorization': "Bearer " + this.tokens['hr_token']},
      'contentType': 'application/x-www-form-urlencoded',
      'payload' : payload
      };
      var response = UrlFetchApp.fetch("https://notify-api.line.me/api/notify", optionHR);

    } //  submit
  } //class application
